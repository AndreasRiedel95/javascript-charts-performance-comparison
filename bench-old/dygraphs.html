<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Dygraphs benchmark app</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" type="text/css" href="style.css" media="screen" />

    <style>
      #wait,
      #reference {
        color: black;
      }
    </style>
  </head>
  <body>
    <h2 id="wait">Loading lib....</h2>

    <script src="config.iife.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/dygraph/2.1.0/dygraph.min.js"></script>
    <link
      rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/dygraph/2.1.0/dygraph.min.css"
    />
    <div id="chart"></div>
    <script>
      let app = undefined
      let data = []

      const createChart = async () => {
        var g = new Dygraph(document.getElementById('chart'), data, {
          drawPoints: false,
          showRoller: false,
          strokeWidth: BENCHMARK_CONFIG.strokeThickness,
          labels: [
            'Time domain',
            ...new Array(BENCHMARK_CONFIG.channelsCount)
              .fill(0)
              .map((_, iChannel) => `Channel #${iChannel + 1}`),
          ],
        });

        app = {
          g
        }
      }

      const setData = async (newData) => {
        data = []
        for (let i = 0; i < newData[0].length; i += 1) {
          const sample = [i]
          for (let ch = 0; ch < newData.length; ch += 1) {
            sample.push(newData[ch][i])
          }
          data.push(sample)
        }
        app.g.updateOptions({ file: data });
      }

      let iDataPoint = 0
      const appendData = async (newData) => {
        const n = newData[0].length
        // Shift out of view points out from data arrays.
        for (let iNewDataPoint = 0; iNewDataPoint < n; iNewDataPoint += 1) {
          data.shift();
        }
        // Add new value to each channel data array.
        for (let iNewDataPoint = 0; iNewDataPoint < n; iNewDataPoint += 1) {
          const newSample = [iDataPoint];
          for (
            let iChannel = 0;
            iChannel < BENCHMARK_CONFIG.channelsCount;
            iChannel += 1
          ) {
            const y = newData[iChannel][iNewDataPoint];
            newSample.push(y);
          }
          data.push(newSample);
          iDataPoint += 1;
        }
        app.g.updateOptions({ file: data });
      }

      window.Test = {
        format: 'y-array',
        createChart,
        setData,
        appendData
      }


      //   let iDataPoint = 0;
      //   const addNDataPoints = (n) => {
      //     // Shift out of view points out from data arrays.
      //     for (let iNewDataPoint = 0; iNewDataPoint < n; iNewDataPoint += 1) {
      //       data.shift();
      //     }
      //     // Add new value to each channel data array.
      //     for (let iNewDataPoint = 0; iNewDataPoint < n; iNewDataPoint += 1) {
      //       const iSourceDataPoint = iDataPoint % sourceData[0].length;
      //       const newSample = [iDataPoint];
      //       for (
      //         let iChannel = 0;
      //         iChannel < BENCHMARK_CONFIG.channelsCount;
      //         iChannel += 1
      //       ) {
      //         const y = sourceData[iChannel][iSourceDataPoint];
      //         newSample.push(y);
      //       }
      //       data.push(newSample);
      //       iDataPoint += 1;
      //     }
      //     g.updateOptions({ file: data });
      //   };


    </script>
    <script src="benchmark.js"></script>

    <p id="reference">
      Code based on
      <a href="https://dygraphs.com/gallery/#g/dynamic-update"
        >https://dygraphs.com/gallery/#g/dynamic-update/</a
      >
    </p>
  </body>
</html>
