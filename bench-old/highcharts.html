<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Highcharts benchmark app</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" type="text/css" href="style.css" media="screen" />

    <style>
      #wait,
      #reference {
        color: black;
      }
    </style>
  </head>
  <body>
    <h2 id="wait">Loading lib....</h2>

    <script src="config.iife.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/boost.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <div id="chart"></div>
    <script>
      let app = undefined

      const createChart = async () => {
        Highcharts.setOptions({
          plotOptions: {
            line: {
              linecap: 'square',
              marker: {
                enabled: false,
              },
            },
            series: {
              animation: false,
            },
          },
        });
        
        const chart = Highcharts.chart('chart', {
          title: {
            text: '',
          },
          boost: {
            
          },
          series: new Array(BENCHMARK_CONFIG.channelsCount)
            .fill(0)
            .map((_, iChannel) => ({
              data: [],
              lineWidth: BENCHMARK_CONFIG.strokeThickness,
              boostThreshold: 1,
            })),
        });

        app = {
          chart
        }
      }

      const setData = async (data) => {
        app.chart.series.forEach((series, i) => {
          series.setData(data[i])
        })
      }

      let iDataPoint = 0
      const appendData = async (data) => {
        const shift = iDataPoint > BENCHMARK_CONFIG.timeDomainInterval

        iDataPoint += data[0].length
        app.chart.series.forEach((series, i) => {
          for (let iDp = 0; iDp < data[i].length; iDp ++) {
            series.addPoint(data[i][iDp], false, shift)
          }
          series.xAxis.update(
            {
              min: iDataPoint - BENCHMARK_CONFIG.timeDomainInterval,
              max: iDataPoint,
            },
            false,
            false
          );
        })
        app.chart.redraw();
      }

      window.Test = {
        format: 'y-array',
        createChart,
        setData,
        appendData
      }

    </script>
    <script src="benchmark.js"></script>

    <p id="reference">
      Code based on
      <a href="https://www.highcharts.com/demo/line-boost"
        >https://www.highcharts.com/demo/line-boost/</a
      >
    </p>
  </body>
</html>
